{% extends "layout.html" %}

{% block content %}
<h1>
    {% if profile and profile.display_name %}
        {{ profile.display_name }}'s Dashboard
    {% else %}
        My Dashboard
    {% endif %}
</h1>
{% if profile and profile.bio %}
    <p style="background-color: #e9ecef; border-left: 4px solid #007bff; padding: 10px; font-style: italic;">
        "{{ profile.bio }}"
    </p>
{% endif %}
 
<div style="background-color: #f8f9fa; padding: 15px; margin-bottom: 20px; border-radius: 5px; display: flex; gap: 30px;">
    <div>
        <strong>Total Watchlist Items:</strong>
        <span style="font-size: 1.2em; color: #007bff;">{{ watchlist_count }}</span>
    </div>
    <div>
        <strong>Your Average Rating:</strong>
        <span style="font-size: 1.2em; color: #28a745;">{{ avg_rating }} / 5.0</span>
    </div>
</div>


<div style="display: flex; gap: 20px;">
    
    <!-- watchlist -->
    <div style="flex: 1;">
        <h2>My Watchlist</h2>
        {% if watchlist %}
            <table>
                <tr><th>Title</th><th>Type</th><th>Action</th></tr>
                {% for item in watchlist %}
                <tr>
                    <td>{{ item.title }}</td>
                    <td>{{ item.content_type }}</td>
                    <td>
                        <form action="/watchlist/remove/{{ item.content_id }}" method="POST">
                            <button type="submit" style="background:red; color:white;">Remove</button>
                        </form>
                        <form action="/rate/{{ item.content_id }}" method="POST" style="display: flex;">
                                <input type="number" name="rating" step="0.1" min="1" max="5" placeholder="1-5" style="width: 50px;" required>
                                <button type="submit">Rate</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Your watchlist is empty.</p>
        {% endif %}
    </div>

    <!-- ratings -->
    <div style="flex: 1;">
        <h2>My Ratings History</h2>
        {% if my_ratings %}
            <table>
                <tr><th>Title</th><th>Rating</th><th>Date</th></tr>
                {% for rate in my_ratings %}
                <tr>
                    <td>{{ rate.title }}</td>
                    <td>{{ rate.rating }}</td>
                    <td>{{ rate.created_at.strftime('%Y-%m-%d') }}</td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>You haven't rated anything yet.</p>
        {% endif %}
    </div>
</div>

<hr style="margin-top: 40px;">
<h2>Your Recent Searches</h2>
{% if recent_searches %}
    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for search in recent_searches %}
            <a href="{{ url_for('search', query=search.search_query) }}" style="background-color: #f0f0f0; padding: 5px 10px; border-radius: 15px; text-decoration: none; color: #333;">
                {{ search.search_query }}
            </a>
        {% endfor %}
    </div>
{% else %}
    <p>You haven't searched for anything yet.</p>
{% endif %}
{% endblock %}